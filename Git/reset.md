==Нельзя использовать эту команду после того, как коммит был опубликован в публичном репозитории!==
Нельзя менять историю коммитов, так как на основании одного из коммитов может базировать работа других коллег. 

Команда `git reset` используется для отмены каких-либо изменений, отката ==ПРОЕКТА== к какому-либо коммиту. После выполнения команды `git reset HEAD~2` все первые два коммита станут недоступными. 
В истории коммитов последним будет тот коммит, на котором находится `HEAD`

Синтаксис комадны:

```bash
$ git reset [ --soft | --mixed | --hard ] [commit | tree-ish]
$ git reset = git reset --mixed HEAD
```

`tree-ish` - это то, что указывает на коммит и эту сущность можно передавать в качестве аргумента для команд git. В данной команде это могут быть вариции с `HEAD`, например `HEAD^^` или `HEAD~2`


### Технологический процесс

Давайте рассмотрим этот процесс: пусть вы перешли в новый каталог, содержащий один файл. Данную версию этого файла будем называть **v1** и изображать голубым цветом. Выполним команду `git init`, которая создаст Git-репозиторий.

На данном этапе только дерево Рабочего Каталога содержит данные.

![[Pasted image 20240430173411.png]]

После выполнения команды `git add` происходит копирование содержимого Рабочего Каталога в Индекс

![[Pasted image 20240430173545.png]]

Затем, мы выполняем команду `git commit`, которая сохраняет содержимое Индекса как неизменяемый снимок, создает объект коммита, который указывает на этот снимок, и обновляет `master` так, чтобы он тоже указывал на этот коммит.

![[Pasted image 20240430173658.png]]

Если сейчас выполнить `git status`, то мы не увидим никаких изменений, так как все три дерева одинаковые.

Теперь мы хотим внести изменения в файл и закоммитить его. Мы пройдём через всё ту же процедуру; сначала мы отредактируем файл в нашем рабочем каталоге. Давайте называть эту версию файла **v2** и обозначать красным цветом.

![[Pasted image 20240430174125.png]]

Если сейчас мы выполним `git status`, то увидим, что файл выделен красным в разделе «Изменения, не подготовленные к коммиту», так как его представления в Индексе и Рабочем Каталоге различны. Затем мы выполним `git add` для этого файла, чтобы поместить его в Индекс.

![[Pasted image 20240430174153.png]]

Если сейчас мы выполним `git status`, то увидим, что этот файл выделен зелёным цветом в разделе «Изменения, которые будут закоммичены», так как Индекс и HEAD различны — то есть, наш следующий намеченный коммит сейчас отличается от нашего последнего коммита. Наконец, мы выполним `git commit`, чтобы окончательно совершить коммит.

![[Pasted image 20240430174301.png]]

Сейчас команда `git status` не показывает ничего, так как снова все три дерева одинаковые.

### Назначение команды `reset`

Команда `reset` становится более понятной, если рассмотреть её с учётом вышеизложенного.

В следующих примерах предположим, что мы снова изменили файл `file.txt` и закоммитили его в третий раз. Так что наша история теперь выглядит так:

![[Pasted image 20240430174758.png]]

Давайте теперь внимательно проследим, что именно происходит при вызове `reset`. Эта команда простым и предсказуемым способом управляет тремя деревьями, существующими в Git. Она выполняет три основных операции.

#### Шаг 1: Перемещение указателя HEAD

Первое, что сделает `reset` — переместит то, на что указывает HEAD. Команда `reset` _с указанием коммита_ всегда будет пытаться сперва сделать данный шаг. 
При вызове `reset --soft` на этом выполнение команды и остановится.

```bash
$ git reset --soft HEAD~
```

Теперь взгляните на диаграмму и постарайтесь разобраться, что случилось: фактически была отменена последняя команда `git commit`. Когда вы выполняете `git commit`, Git создает новый коммит и перемещает на него ветку, на которую указывает HEAD. Если вы выполняете `reset` на `HEAD~` (родителя HEAD), то вы перемещаете ветку туда, где она была раньше, не изменяя при этом ни Индекс, ни Рабочий Каталог.

![[Pasted image 20240430180915.png]]

#### Шаг 2: Обновление Индекса (--mixed)

Заметьте, если сейчас вы выполните `git status`, то увидите отмеченные зелёным цветом изменения между Индексом и новым HEAD.

Следующим, что сделает `reset`, будет обновление Индекса содержимым того снимка, на который указывает HEAD.

```bash
$ git reset --mixed HEAD~ || git reset HEAD~
```

Если вы указали опцию `--mixed`, выполнение `reset` остановится на этом шаге. Такое поведение также используется по умолчанию (без ключа `--mixed`)

Снова взгляните на диаграмму и постарайтесь разобраться, что произошло: отменен не только ваш последний `commit`, но также и _добавление в индекс_ всех файлов. Вы откатились назад до момента выполнения команд `git add` и `git commit`.

![[Pasted image 20240430181433.png]]


#### Шаг 3: Обновление Рабочего Каталога (--hard)

Третье, что сделает `reset` - это приведение вашего Рабочего Каталога к тому же виду, что и Индекс. Если вы используете опцию `--hard`, то выполнение команды будет продолжено до этого шага.

```bash
$ git reset --hard HEAD~
```

Давайте разберемся, что сейчас случилось. Вы отменили ваш последний коммит, результаты выполнения команд `git add` и `git commit`, а также **все** изменения, которые вы сделали в рабочем каталоге.

Важно отметить, что только указание этого флага (`--hard`) делает команду `reset` опасной, это один из немногих случаев, когда ==Git действительно удаляет данные.== Все остальные вызовы `reset` легко отменить, но при указании опции `--hard` команда принудительно перезаписывает файлы в Рабочем Каталоге. В данном конкретном случае, версия **v3** нашего файла всё ещё остаётся в коммите внутри базы данных Git и мы можем вернуть её, просматривая наш `reflog`, но если вы не коммитили эту версию, Git перезапишет файл и её уже нельзя будет восстановить.

![[Pasted image 20240430181734.png]]

#### Резюме

Команда `reset` в заранее определённом порядке перезаписывает три дерева Git, останавливаясь тогда, когда вы ей скажете:

1. Перемещает ветку, на которую указывает HEAD (останавливается на этом, если указана опция `--soft`)
2. Делает Индекс таким же как и HEAD (останавливается на этом, если указана опция `--mixed`)
3. Делает Рабочий Каталог таким же как и Индекс (если указана опция `--hard`)


### Reset с указанием пути

```bash
$ git reset <file>
```

Эта команда используется для отмены индексации файла, то есть фактически копирует файл из `HEAD` в индекс.  Команда `git add` делает противоположное действие - добавляет файл в индекс из рабочей директории

![[Pasted image 20240430200752.png]]
`$ git reset file.txt`

![[Pasted image 20240430200953.png]]
`$ git add file.txt`

Именно поэтому в выводе `git status` предлагается использовать такую команду для отмены индексации файла:
```console
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)
```

